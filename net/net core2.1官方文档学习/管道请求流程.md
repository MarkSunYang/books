建立一个控制台程序：

.NET Core请求处理管道由一个服务器和一组中间件构成


一、建立在“模拟管道”上的应用


二、HttpApplication——一组中间件的有序集合
ASP.NET Core请求处理管道由一个服务器和一组有序排列的中间件组合而成。
我们可以在这基础上作进一步个抽象，将后者抽象成一个HttpApplication对象，那么该管道就成了一个Server和HttpApplication的综合体（如下图所示）。
Server会将接收到的HTTP请求转发给HttpApplication对象，后者会针对当前请求创建一个上下文，并在此上下文中处理请求，请求处理完成并完成响应之后HttpApplication会对此上下文实施回收释放处理。

我们通过具有如下定义的IHttpApplication<TContext>类型来表示上述的这个HttpApplication，
泛型参数TContext代表它针对每个请求而建立的上下文。
一个HttpApplication对象在接收到Server转发的请求之后需要完成三项基本的操作，
#1.创建上下文 2.在上下文中处理请求 3.请求处理完成之后释放上下文，
这三个基本操作正好通过对应的三个方法来完成。

public interface IHttpApplication<TContext>
{
   TContext CreateContext(IFeatureCollection contextFeatures); 
   Task ProcessRequestAsync(TContext context);
   void DisposeContext(TContext context, Exception exception);
}
用于创建上下文的CreateContext方法具有一个类型为IFeatureCollection接口的参数。
顾名思义，这个接口用于描述某个对象所具有的一组特性，
我们可以将它视为一个Dictionary<Type, object>对象，字典对象的Value代表特性对象，Key则表示该对象的注册类型（可以是特性描述对象的真实类型、真实类型的基类或者实现的接口）。
我们可以调用Get方法根据指定的注册类型得到设置的特性对象，特性对象的注册则通过Set方法来完成。我们自定义的FeatureCollection类型采用最简单的方式实现了这个接口。


管道采用的HttpApplication是一个类型为 HostingApplication的对象。这个类型实现了接口IHttpApplication<Context>，泛型参数Context是一个针对当前请求的上下文对象。
一个Context对象是对一个HttpContext的封装，后者是真正描述当前HTTP请求的上下文，承载着最为核心的上下文信息。
除此之外，我们还为Context定义了Scope和StartTimestamp两个属性，两者与日志记录和事件追踪有关，前者被用来将针对同一请求的多次日志记录关联到同一个上下文范围（即Logger的BeginScope方法的返回值）；后者表示开始处理请求的时间戳，如果在完成请求处理的时候记录下当前的时间戳，我们就可以计算出整个请求处理所花费的时间。


管道采用的HttpApplication是一个类型为 HostingApplication的对象。如下面的代码片段所示，这个类型实现了接口IHttpApplication<Context>，泛型参数Context是一个针对当前请求的上下文对象。一个Context对象是对一个HttpContext的封装，后者是真正描述当前HTTP请求的上下文，承载着最为核心的上下文信息。除此之外，我们还为Context定义了Scope和StartTimestamp两个属性，两者与日志记录和事件追踪有关，前者被用来将针对同一请求的多次日志记录关联到同一个上下文范围（即Logger的BeginScope方法的返回值）；后者表示开始处理请求的时间戳，如果在完成请求处理的时候记录下当前的时间戳，我们就可以计算出整个请求处理所花费的时间。

三、HttpContext——对当前HTTP上下文的抽象


四、服务器——实现对请求的监听、接收和响应